@page "/admin"
@using DocumentManagementSystem.Services
@inject DocumentService DocumentService
@inject UserService UserService
@inject NavigationManager Nav

<h2>Admin Dashboard</h2>

@if (!IsAdmin)
{
    <div class="text-danger">Access denied. Admins only.</div>
}

@if (Loading)
{
    <p>Loading dashboard...</p>
}
else
{
    <div class="dashboard-grid">

        <div class="card">
            <h3>Total Documents</h3>
            <p class="count">@TotalDocuments</p>
        </div>

        <div class="card">
            <h3>Total Users</h3>
            <p class="count">@TotalUsers</p>
        </div>

        <div class="card">
            <h3>Total Offices</h3>
            <p class="count">@TotalOffices</p>
        </div>

        <div class="card">
            <h3>Documents Uploaded Today</h3>
            <p class="count">@DocumentsToday</p>
        </div>

    </div>
}

@code {
    private bool Loading = true;
    private bool IsAdmin = true; // Replace later with session role check

    private int TotalDocuments;
    private int TotalUsers;
    private int TotalOffices;
    private int DocumentsToday;

    protected override async Task OnInitializedAsync()
    {
        // TODO: Replace with real session role
        IsAdmin = true;

        // Load values from services
        TotalDocuments = DocumentService.CountAllDocuments();
        TotalUsers = UserService.CountAllUsers();
        TotalOffices = DocumentService.CountOffices();
        DocumentsToday = DocumentService.CountDocumentsUploadedToday();

        Loading = false;
    }

    protected override void OnInitialized()
    {
        if (!IsAdmin)
        {
            Nav.NavigateTo("/");
            return;
        }
    }
}

<style>
.dashboard-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 20px;
    margin-top: 20px;
}

.card {
    background: #ffffff;
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0px 2px 8px rgba(0,0,0,0.1);
    text-align: center;
}

.card h3 {
    margin-bottom: 10px;
}

.count {
    font-size: 2rem;
    font-weight: bold;
    color: #007bff;
}
</style>
